/**
 * Created by brugnara on 15/07/16,
 * @ daniele@brugnara.me
 */

const Debug = require('debug');
const DEFAULT_SCOPE = 'corso:error_500';

module.exports = function (options) {

  options = options || {};

  const debug = Debug(options.scope || DEFAULT_SCOPE);

  debug('cargando...');

  return function *(next) {
    try {
      yield next;
    } catch(e) {
      debug('oibo! E\' suces sta roba qua: %s', e.message);
      debug('Stacktrace: %s', e.stack);
      debug('On url: %s - %s', this.method, this.path);
      this.status = e.status || 500;
      this.body = 'ERROR: ' + e.message;
    }
  }

};

