
//

const Router = require('koa-router');
const Debug = require('debug');
const DEFAULT_SCOPE = 'corso:middleware:api';
const DEFAULT_FILE = './index.html';
const fs = require('fs');

module.exports = function(options) {

  const router = new Router();
  const debug = Debug(options.scope || DEFAULT_SCOPE);
  const FILE = options.file || DEFAULT_FILE;

  debug('cargando...');

  router.get('/', function *(next) {
    debug('chiamata /');

    this.body = 'eccomi qui!';
    yield next;
  });

  router.get('/ciao', function*(next) {
    debug('hello world!');

    this.body = 'hello world!';
    yield next;
  });

  router.get('/hello/:what?', function*(next) {
    if (!this.params.what) {
      debug('ouch!');
    }

    debug('hello %s!', this.params.what);

    this.body = 'hello ' + this.params.what;
    yield next;
  });

  router.get('/bla/:bli/:blu', function*(next) {
    debug(this.params);
    this.body = this.params.bli + this.params.blu;
    yield next;
  });

  router.get('/index.php', function*(next) {
    debug(this.query);
    this.body = fs.createReadStream(FILE, 'utf8');
    yield next;
  });

  return router;

};
