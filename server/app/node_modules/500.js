/**
 * Created by brugnara on 14/07/16,
 * @ daniele@brugnara.me
 */

'use strict';

const Debug = require('debug');
const DEFAULT_SCOPE = 'corso:500';

module.exports = function (options) {

  options = options || {};

  const debug = Debug(options.scope || DEFAULT_SCOPE);

  return function *(next) {
    try {
      yield next;
    } catch(e) {
      debug(e);
      this.status = e.status || 500;
      this.body = {
        status: 'ko',
        when: new Date(),
        payload: {
          body: this.body || null,
          params: this.params || null,
          request: this.request,
          response: this.response
        },
        error: e.message,
        stack: e.stack
      }
    }
  }

};

